{"version":3,"file":"VaAffix.vue_vue_type_script_setup_true_lang.js","sources":["../../../../../src/components/va-affix/VaAffix.vue"],"sourcesContent":["<template>\n  <div\n    ref=\"element\"\n    class=\"va-affix\"\n  >\n    <div :style=\"{ visibility: isAffixed ? 'hidden' : 'inherit' }\">\n      <slot />\n    </div>\n    <div\n      v-if=\"isAffixed\"\n      :class=\"computedClass\"\n      :style=\"computedStyle\"\n    >\n      <slot />\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed, PropType, ref, nextTick, onMounted, onBeforeUnmount, shallowRef } from 'vue'\nimport noop from 'lodash/noop.js'\n\nimport { getWindow } from '../../utils/ssr'\nimport { useComponentPresetProp } from '../../composables/useComponentPreset'\nimport { useNumericProp } from '../../composables/useNumericProp'\n\nimport {\n  handleThrottledEvent,\n  useEventsHandlerWithThrottle,\n  getWindowHeight,\n  State,\n  Context,\n} from './VaAffix-utils'\n\ndefineOptions({\n  name: 'VaAffix',\n})\n\nconst props = defineProps({\n  ...useComponentPresetProp,\n  offsetTop: { type: [Number, String], default: undefined },\n  offsetBottom: { type: [Number, String], default: undefined },\n  target: { type: [Object, Function] as PropType<HTMLElement | Window | (() => HTMLElement | Window)>, default: getWindow },\n})\n\nconst emit = defineEmits(['change'])\n\nconst element = shallowRef<HTMLElement>()\n\nconst getTargetElement = () => (typeof props.target === 'function' ? props.target() : props.target)\n\nconst isAffixed = computed(() => state.value.isTopAffixed || state.value.isBottomAffixed)\n\nconst state = ref<State>({\n  isTopAffixed: false,\n  isBottomAffixed: false,\n})\nconst getState = () => state.value\nconst setState = (newState: State) => {\n  state.value = newState\n  emit('change', isAffixed)\n}\n\nconst offsetTopComputed = useNumericProp('offsetTop')\nconst offsetBottomComputed = useNumericProp('offsetBottom')\n\nconst calculateTop = () => {\n  const target = getTargetElement()\n\n  if (!target) {\n    return 0\n  }\n\n  if (offsetTopComputed.value === undefined) { return }\n\n  if (!(target instanceof Window)) {\n    const { top } = target.getBoundingClientRect()\n    return top + offsetTopComputed.value\n  }\n\n  return offsetTopComputed.value\n}\n\nconst calculateBottom = () => {\n  const target = getTargetElement()\n\n  if (!target) { return 0 }\n\n  if (offsetBottomComputed.value === undefined) { return }\n\n  if (!(target instanceof Window)) {\n    const { bottom } = target.getBoundingClientRect()\n    const { borderTopWidth, borderBottomWidth } = getComputedStyle(target)\n    const { offsetHeight, clientHeight } = target\n\n    const scrollBarHeight = offsetHeight - clientHeight - parseInt(borderTopWidth) - parseInt(borderBottomWidth)\n\n    return getWindowHeight() - (bottom - offsetBottomComputed.value) + scrollBarHeight\n  }\n\n  return offsetBottomComputed.value\n}\n\nconst convertToPixels = (calculate: () => number | undefined) => {\n  const result = calculate()\n  return result === undefined ? undefined : `${result}px`\n}\n\nconst computedClass = computed(() => [{ 'va-affix--affixed': isAffixed }])\nconst computedStyle = computed(() => ({\n  top: state.value.isTopAffixed ? convertToPixels(calculateTop) : undefined,\n  bottom: state.value.isBottomAffixed ? convertToPixels(calculateBottom) : undefined,\n  width: `${state.value.width}px`,\n}))\n\nconst initialPosition = ref<DOMRect>()\nconst throttledEventHandler = (eventName: string | null, event?: Event) => {\n  const context: Context = {\n    ...props,\n    offsetTop: offsetTopComputed.value,\n    offsetBottom: offsetBottomComputed.value,\n    initialPosition: initialPosition.value,\n    element: element.value,\n    target: getTargetElement(),\n    setState,\n    getState,\n  }\n\n  if (!eventName || eventName === 'resize') {\n    handleThrottledEvent(eventName, context)\n  } else if (event && event.target) {\n    const target = getTargetElement()\n\n    if (target === event.target || target instanceof Window) {\n      handleThrottledEvent(eventName, context)\n    } else {\n      // if we have a custom target but keep scrolling on another element,\n      // so just disable the affixed state\n      setState({\n        isBottomAffixed: false,\n        isTopAffixed: false,\n      })\n    }\n  }\n}\n\nlet clearEventListeners: () => any = noop\n\nonMounted(() => {\n  initialPosition.value = element.value?.getBoundingClientRect()\n\n  const events = ['scroll', 'resize']\n\n  clearEventListeners = useEventsHandlerWithThrottle(events, {\n    handler: throttledEventHandler,\n  })\n\n  nextTick(() => {\n    // pass `null` here to make sure it is an initial call\n    throttledEventHandler(null)\n  })\n})\n\nonBeforeUnmount(clearEventListeners)\n</script>\n\n<style lang=\"scss\">\n@import \"variables\";\n\n.va-affix {\n  font-family: var(--va-font-family);\n\n  &--affixed {\n    position: var(--va-affix-affixed-position);\n    z-index: var(--va-affix-affixed-z-index);\n  }\n}\n</style>\n"],"names":[],"mappings":"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"}