{"version":3,"file":"VaVirtualScroller.vue_vue_type_script_setup_true_lang.js","sources":["../../../../../src/components/va-virtual-scroller/VaVirtualScroller.vue"],"sourcesContent":["<template>\n  <div\n    ref=\"wrapper\"\n    class=\"va-virtual-scroller\"\n    :style=\"wrapperStyleComputed\"\n    :class=\"wrapperClassComputed\"\n  >\n    <slot\n      name=\"content\"\n      v-bind=\"{ containerStyleComputed, listStyleComputed, renderBuffer, uniqueKey, currentListOffset }\"\n    >\n      <div\n        class=\"va-virtual-scroller__container\"\n        :style=\"containerStyleComputed\"\n      >\n        <div\n          ref=\"list\"\n          role=\"list\"\n          class=\"va-virtual-scroller__list\"\n          :style=\"listStyleComputed\"\n        >\n          <template\n            v-for=\"(item, index) in renderBuffer\"\n            :key=\"uniqueKey(item, index)\"\n          >\n            <slot name=\"default\" v-bind=\"{ item, index: renderStartIndex + index }\" />\n          </template>\n        </div>\n      </div>\n    </slot>\n  </div>\n</template>\n\n<script lang=\"ts\" setup generic=\"Item\">\nimport { ref, computed, watch, PropType, ComputedRef } from 'vue'\nimport pick from 'lodash/pick.js'\n\nimport { useEvent, useBem, useTrackBy, useTrackByProps, useNumericProp } from '../../composables'\nimport { useVirtualScrollerSizes, useVirtualScrollerSizesProps } from './useVirtualScrollerSizes'\n\ndefineOptions({\n  name: 'VaVirtualScroller',\n})\n\nconst props = defineProps({\n  ...useTrackByProps,\n  ...useVirtualScrollerSizesProps,\n  items: { type: Array as PropType<Item[]>, default: () => ([]) },\n  bench: { type: [Number, String], default: 10, validator: (v: number | string) => Number(v) >= 0 },\n  disabled: { type: Boolean, default: false },\n  table: { type: Boolean, default: false },\n})\n\nconst emit = defineEmits(['scroll:bottom'])\n\nconst listScrollPosition = ref(0)\nconst benchComputed = useNumericProp('bench') as ComputedRef<number>\n\nconst scrollDirection = computed(() => props.horizontal ? 'scrollLeft' : 'scrollTop')\nconst handleScroll = () => {\n  if (!wrapper.value) { return }\n  listScrollPosition.value = wrapper.value[scrollDirection.value]\n}\nif (!props.disabled) { useEvent('scroll', handleScroll, true) }\n\nconst { list, wrapper, itemSize, wrapperSize } = useVirtualScrollerSizes(props, listScrollPosition)\n\nconst { getKey } = useTrackBy(props)\nconst uniqueKey = (item: Array<any> | Record<string, any>, index: number, defaultValue?: any) => getKey(item, index, defaultValue)\n\nwatch(listScrollPosition, (newValue) => {\n  if (newValue + wrapperSize.value === containerSize.value) {\n    emit('scroll:bottom')\n  }\n})\n\n// forming items to render\nconst renderStartIndex = computed(() => {\n  return Math.max(0, Math.floor(listScrollPosition.value / itemSize.value) - benchComputed.value)\n})\nconst renderItemsAmount = computed(() => {\n  if (!props.items?.length) { return 0 }\n  return props.disabled\n    ? props.items.length\n    : Math.min(props.items.length - renderStartIndex.value, Math.ceil(wrapperSize.value / itemSize.value) + benchComputed.value * 2)\n})\nconst renderEndIndex = computed(() => renderStartIndex.value + renderItemsAmount.value)\nconst renderBuffer = computed(() => {\n  if (!props.items?.length) { return [] }\n  return props.items.slice(renderStartIndex.value, renderEndIndex.value)\n})\n\nconst sizeAttribute = computed(() => props.horizontal ? 'width' : 'height')\n\n// wrapper styles and classes\nconst isDisabledVirtualTable = computed(() => props.table && props.disabled)\n\nconst wrapperStyleComputed = computed(() => ({\n  [sizeAttribute.value]: isDisabledVirtualTable.value || !wrapperSize.value ? undefined : `${wrapperSize.value}px`,\n}))\nconst wrapperClassComputed = useBem('va-virtual-scroller', () => ({\n  ...pick(props, ['horizontal']),\n}))\n\n// container styles\nconst containerSize = computed(() => (props.items?.length ?? 0) * itemSize.value)\nconst containerStyleComputed = computed(() => ({\n  [sizeAttribute.value]: isDisabledVirtualTable.value ? undefined : `${containerSize.value}px`,\n}))\n\n// items list styles\nconst currentListOffset = computed(() => renderStartIndex.value * itemSize.value)\nconst listStyleComputed = computed(() => ({\n  transform: `translate${props.horizontal ? 'X' : 'Y'}(${currentListOffset.value}px)`,\n}))\n\n// public\nconst scrollToAttribute = computed(() => props.horizontal ? 'left' : 'top')\nconst virtualScrollTo = (index: number) => {\n  if (!index && index !== 0) { return }\n\n  wrapper.value?.scrollTo({ [scrollToAttribute.value]: index * itemSize.value })\n}\n\ndefineExpose({\n  scrollToAttribute,\n  virtualScrollTo,\n})\n</script>\n\n<style lang=\"scss\">\n.va-virtual-scroller {\n  overflow: auto;\n  width: 100%;\n  height: 100%;\n\n  &__container {\n    position: relative;\n    overflow: hidden;\n    min-width: 100%;\n    min-height: 100%;\n  }\n\n  &__list {\n    display: flex;\n    flex-direction: column;\n  }\n\n  &--horizontal {\n    & .va-virtual-scroller__list {\n      flex-direction: row;\n    }\n  }\n}\n</style>\n"],"names":[],"mappings":"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"}