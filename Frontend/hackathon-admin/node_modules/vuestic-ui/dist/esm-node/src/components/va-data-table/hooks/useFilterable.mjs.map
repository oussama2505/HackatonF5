{"version":3,"file":"useFilterable.mjs","sources":["../../../../../../src/components/va-data-table/hooks/useFilterable.ts"],"sourcesContent":["import { Ref, watch, computed, PropType, ExtractPropTypes } from 'vue'\n\nimport { useThrottleValue, useThrottleProps } from '../../../composables'\n\nimport type { DataTableRow, DataTableFilterMethod, DataTableItem } from '../types'\n\nexport const useFilterableProps = {\n  ...useThrottleProps,\n  filter: { type: String, default: '' },\n  filterMethod: { type: Function as PropType<DataTableFilterMethod | undefined> },\n}\n\nexport type TFilteredArgs = { items: DataTableItem[], itemsIndexes: number[] }\nexport type TFilterableEmits = (event: 'filtered', arg: TFilteredArgs) => void\n\nexport const useFilterable = <Item extends DataTableRow>(\n  rawRows: Ref<Item[]>,\n  props: ExtractPropTypes<typeof useFilterableProps>,\n  emit: TFilterableEmits,\n) => {\n  const filteredRows = computed<Item[]>(() => {\n    if (!rawRows.value.length) {\n      return rawRows.value\n    }\n\n    if (props.filter === '' && !props.filterMethod) {\n      return rawRows.value\n    }\n\n    return rawRows.value.filter((row) =>\n      row.cells.some((cell) => {\n        if (typeof props.filterMethod === 'function') {\n          return props.filterMethod(cell.source, cell)\n        }\n\n        const cellRegex = new RegExp(props.filter, 'i')\n        return cellRegex.test(cell.value)\n      }),\n    )\n  })\n\n  const filteredRowsThrottled = useThrottleValue(filteredRows, props)\n\n  watch(filteredRowsThrottled, () => {\n    emit('filtered', {\n      items: filteredRowsThrottled.value.map(row => row.source),\n      itemsIndexes: filteredRowsThrottled.value.map(row => row.initialIndex),\n    })\n  })\n\n  if (filteredRows.value.length !== rawRows.value.length) {\n    emit('filtered', {\n      items: filteredRows.value.map(row => row.source),\n      itemsIndexes: filteredRows.value.map(row => row.initialIndex),\n    })\n  }\n\n  return {\n    filteredRows: filteredRowsThrottled,\n  }\n}\n"],"names":[],"mappings":";;AAMO,MAAM,qBAAqB;AAAA,EAChC,GAAG;AAAA,EACH,QAAQ,EAAE,MAAM,QAAQ,SAAS,GAAG;AAAA,EACpC,cAAc,EAAE,MAAM,SAAwD;AAChF;AAKO,MAAM,gBAAgB,CAC3B,SACA,OACA,SACG;AACG,QAAA,eAAe,SAAiB,MAAM;AACtC,QAAA,CAAC,QAAQ,MAAM,QAAQ;AACzB,aAAO,QAAQ;AAAA,IACjB;AAEA,QAAI,MAAM,WAAW,MAAM,CAAC,MAAM,cAAc;AAC9C,aAAO,QAAQ;AAAA,IACjB;AAEA,WAAO,QAAQ,MAAM;AAAA,MAAO,CAAC,QAC3B,IAAI,MAAM,KAAK,CAAC,SAAS;AACnB,YAAA,OAAO,MAAM,iBAAiB,YAAY;AAC5C,iBAAO,MAAM,aAAa,KAAK,QAAQ,IAAI;AAAA,QAC7C;AAEA,cAAM,YAAY,IAAI,OAAO,MAAM,QAAQ,GAAG;AACvC,eAAA,UAAU,KAAK,KAAK,KAAK;AAAA,MAAA,CACjC;AAAA,IAAA;AAAA,EACH,CACD;AAEK,QAAA,wBAAwB,iBAAiB,cAAc,KAAK;AAElE,QAAM,uBAAuB,MAAM;AACjC,SAAK,YAAY;AAAA,MACf,OAAO,sBAAsB,MAAM,IAAI,CAAA,QAAO,IAAI,MAAM;AAAA,MACxD,cAAc,sBAAsB,MAAM,IAAI,CAAA,QAAO,IAAI,YAAY;AAAA,IAAA,CACtE;AAAA,EAAA,CACF;AAED,MAAI,aAAa,MAAM,WAAW,QAAQ,MAAM,QAAQ;AACtD,SAAK,YAAY;AAAA,MACf,OAAO,aAAa,MAAM,IAAI,CAAA,QAAO,IAAI,MAAM;AAAA,MAC/C,cAAc,aAAa,MAAM,IAAI,CAAA,QAAO,IAAI,YAAY;AAAA,IAAA,CAC7D;AAAA,EACH;AAEO,SAAA;AAAA,IACL,cAAc;AAAA,EAAA;AAElB;"}