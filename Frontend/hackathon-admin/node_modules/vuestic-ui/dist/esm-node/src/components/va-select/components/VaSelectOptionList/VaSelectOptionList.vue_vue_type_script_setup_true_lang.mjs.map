{"version":3,"file":"VaSelectOptionList.vue_vue_type_script_setup_true_lang.mjs","sources":["../../../../../../../src/components/va-select/components/VaSelectOptionList/VaSelectOptionList.vue"],"sourcesContent":["<template>\n  <div\n    ref=\"root\"\n    class=\"va-select-option-list\"\n    :tabindex=\"tabindex\"\n    @keydown.up.stop.prevent=\"focusPreviousOption\"\n    @keydown.left.stop.prevent=\"focusPreviousOption\"\n    @keydown.down.stop.prevent=\"focusNextOption\"\n    @keydown.right.stop.prevent=\"focusNextOption\"\n    @keydown.enter.stop.prevent=\"selectHoveredOption\"\n    @keydown.space.stop.prevent=\"selectHoveredOption\"\n    @scroll.passive=\"onScroll\"\n    role=\"listbox\"\n    :aria-multiselectable=\"$props.multiple\"\n  >\n    <template\n      v-for=\"(options, groupName) in optionGroupsThrottled\"\n      :key=\"groupName\"\n    >\n      <span\n        v-if=\"groupName !== '_noGroup'\"\n        class=\"va-select-option-list__group-name\"\n        role=\"presentation\"\n      >\n        {{ groupName }}\n      </span>\n      <va-virtual-scroller\n        v-if=\"$props.virtualScroller\"\n        ref=\"virtualScrollerRef\"\n        :items=\"options\"\n        :track-by=\"getTrackBy\"\n        :wrapper-size=\"rootHeight\"\n        @scroll:bottom=\"handleScrollToBottom\"\n        v-slot=\"{ item: option, index }\"\n      >\n        <slot v-bind=\"{ option, index, selectOption: (o = option) => selectOption(o) }\">\n          <va-select-option\n            :option=\"option\"\n            :current-option=\"currentOptionComputed\"\n            :disabled=\"getDisabled(option)\"\n            v-bind=\"selectOptionProps\"\n            @click.stop=\"selectHoveredOption\"\n            @mouseenter=\"handleMouseEnter(option)\"\n            @mousemove=\"handleMouseMove(option)\"\n          />\n        </slot>\n      </va-virtual-scroller>\n\n      <template v-else>\n        <template v-for=\"(option, index) in options\" :key=\"getTrackBy(option)\">\n          <slot v-bind=\"{ option, index, selectOption }\">\n            <va-select-option\n              :ref=\"setItemRef(getTrackBy(option))\"\n              :current-option=\"currentOptionComputed\"\n              :option=\"option\"\n              :disabled=\"getDisabled(option)\"\n              v-bind=\"selectOptionProps\"\n              @click.stop=\"selectHoveredOption\"\n              @mouseenter=\"handleMouseEnter(option)\"\n              @mousemove=\"handleMouseMove(option)\"\n            >\n              <template #option-content>\n                <slot name=\"option-content\" v-bind=\"{ option, index }\" />\n              </template>\n            </va-select-option>\n          </slot>\n        </template>\n      </template>\n    </template>\n    <div\n      v-if=\"!filteredOptions.length\"\n      class=\"va-select-option-list--empty\"\n    >\n      {{ noOptionsText }}\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { PropType, ref, shallowRef, watch, computed, ComponentPublicInstance, ComputedRef } from 'vue'\nimport pick from 'lodash/pick.js'\n\nimport {\n  useComponentPresetProp,\n  useColorProps,\n  useObjectRefs,\n  useSelectableList, useSelectableListProps,\n  useThrottleValue, useThrottleProps, useNumericProp,\n} from '../../../../composables'\n\nimport { scrollToElement } from '../../../../utils/scroll-to-element'\n\nimport { VaVirtualScroller } from '../../../va-virtual-scroller'\nimport { VaSelectOption } from '../VaSelectOption'\n\nimport { isNilValue } from '../../../../utils/isNilValue'\n\nimport type { SelectOption, EventSource } from '../../types'\nimport { unwrapEl } from '../../../../utils/unwrapEl'\n\ndefineOptions({\n  name: 'VaSelectOptionList',\n})\n\nconst props = defineProps({\n  ...useColorProps,\n  ...useComponentPresetProp,\n  ...useSelectableListProps,\n  ...useThrottleProps,\n  noOptionsText: { type: String, default: 'Items not found' },\n  getSelectedState: { type: Function as PropType<(option: SelectOption) => boolean>, required: true },\n  multiple: { type: Boolean, default: false },\n  search: { type: String, default: '' },\n  tabindex: { type: [String, Number], default: 0 },\n  hoveredOption: { type: [String, Number, Boolean, Object] as PropType<SelectOption | null>, default: null },\n  virtualScroller: { type: Boolean, default: true },\n  highlightMatchedText: { type: Boolean, default: true },\n  minSearchChars: { type: [Number, String], default: 0 },\n  autoSelectFirstOption: { type: Boolean, default: false },\n  selectedTopShown: { type: Boolean, default: false },\n  doShowAllOptions: { type: Boolean, default: false },\n})\n\nconst emit = defineEmits([\n  'select-option',\n  'update:hoveredOption',\n  'no-previous-option-to-hover',\n  'scroll-bottom',\n])\n\nconst root = shallowRef<HTMLElement>()\nconst focus = () => {\n  // Prevent scroll since element in dropdown and it causes scrolling to page end.\n  root.value?.focus({ preventScroll: true })\n}\nconst rootHeight = computed(() => root.value?.clientHeight ?? 200)\n\nconst handleScrollToBottom = () => emit('scroll-bottom')\nconst onScroll = (event: UIEvent) => {\n  const target = event.target as Element\n  if (!target) { return }\n\n  if (target.scrollTop + target.clientHeight === target.scrollHeight) {\n    handleScrollToBottom()\n  }\n}\n\nconst lastInteractionSource = ref<EventSource>('')\nconst currentOptionComputed = computed(() => props.hoveredOption ?? null)\nconst updateCurrentOption = (option: SelectOption | null, source: EventSource) => {\n  emit('update:hoveredOption', option)\n  lastInteractionSource.value = source\n}\n\nconst { getText, getGroupBy, getTrackBy, getDisabled } = useSelectableList(props)\nconst minSearchCharsComputed = useNumericProp('minSearchChars') as ComputedRef<number>\n\nconst currentSelectedOptionText = computed(() => {\n  const getSelectedState = props.getSelectedState\n  const selected = props.options?.find((option) => getSelectedState(option))\n\n  return selected ? getText(selected) : ''\n})\n\nconst isSearchedOptionSelected = computed(() => {\n  return currentSelectedOptionText.value.toLowerCase() === props.search?.toLowerCase()\n})\n\nconst filteredOptions = computed((): SelectOption[] => {\n  if (props.doShowAllOptions && isSearchedOptionSelected.value) {\n    return props.options\n  }\n\n  if (!props.search || props.search.length < minSearchCharsComputed.value) {\n    return props.options\n  }\n\n  const search = props.search.toUpperCase().trim()\n\n  return props.options.filter((option: SelectOption) => {\n    const optionText = getText(option).toUpperCase()\n    return optionText.includes(search)\n  })\n})\n\nconst optionGroups = computed(() => {\n  if (!props.groupBy) { return { _noGroup: filteredOptions.value } }\n\n  return filteredOptions.value\n    .reduce((groups: Record<string, SelectOption[]>, option) => {\n      const groupBy = getGroupBy(option)\n\n      if (!groupBy) {\n        groups._noGroup.push(option)\n      } else {\n        if (!groups[groupBy]) { groups[groupBy] = [] }\n\n        groups[groupBy].push(option)\n      }\n\n      return groups\n    }, { _noGroup: [] })\n})\nconst optionGroupsThrottled = useThrottleValue(optionGroups, props)\n\nconst isValueExists = (value: SelectOption | null | undefined): value is SelectOption => !isNilValue(value)\n\nconst updateHoveredOption = (option?: SelectOption) => {\n  if (option === currentOptionComputed.value || (isValueExists(option) && getDisabled(option))) { return }\n\n  updateCurrentOption(option ?? null, 'mouse')\n}\nconst updateFocusedOption = (option?: SelectOption) => { updateCurrentOption(option ?? null, 'keyboard') }\n\nconst selectHoveredOption = () => {\n  const previousOption =\n    previousOptionComputed.value && typeof previousOptionComputed.value === 'object'\n      ? { ...previousOptionComputed.value }\n      : previousOptionComputed.value\n\n  emit('select-option')\n\n  if (props.selectedTopShown) {\n    updateHoveredOption(previousOption)\n  }\n}\n\nconst groupedOptions = computed(() => Object.values(optionGroupsThrottled.value).flat())\nconst currentOptions = computed(() =>\n  filteredOptions.value.some((el) => getGroupBy(el)) ? groupedOptions.value : filteredOptions.value)\n\nconst currentOptionIndex = computed(() => currentOptions.value.findIndex((option) => {\n  return isValueExists(currentOptionComputed.value) && getTrackBy(option) === getTrackBy(currentOptionComputed.value)\n}))\n\nconst selectOptionProps = computed(() => ({\n  ...pick(props, ['getSelectedState', 'color', 'search', 'highlightMatchedText']),\n  minSearchChars: minSearchCharsComputed.value,\n  getText,\n  getTrackBy,\n}))\n\nconst findNextActiveOption = (startSearchIndex: number, reversedSearch = false) => {\n  const searchBase = [...(currentOptions.value || [])]\n  const searchBaseOrdered = reversedSearch ? searchBase.reverse() : searchBase\n  const startIndex = reversedSearch ? (startSearchIndex * -1) - 1 : startSearchIndex\n\n  return searchBaseOrdered.slice(startIndex).find((option) => !getDisabled(option))\n}\n\nconst previousOptionComputed = computed((): SelectOption | undefined => {\n  const previousOptionIndex = currentOptionIndex.value - 1\n  const previousOption = currentOptions.value[previousOptionIndex]\n  const previousOptionCheck = isValueExists(previousOption) && !(previousOptionIndex === 0 && getDisabled(previousOption))\n\n  if (previousOptionCheck) {\n    return findNextActiveOption(currentOptionIndex.value - 1, true)\n  }\n\n  return undefined\n})\n\nconst selectOption = (option: SelectOption) => {\n  updateHoveredOption(option)\n  emit('select-option')\n}\n\nconst handleMouseMove = (option: SelectOption) => {\n  if (!props.selectedTopShown) { updateHoveredOption(option) }\n}\n\nconst handleMouseEnter = (option: SelectOption) => {\n  if (props.selectedTopShown) { updateHoveredOption(option) }\n}\n\n// public\nconst focusPreviousOption = () => {\n  if (!isValueExists(currentOptionComputed.value)) {\n    updateFocusedOption(findNextActiveOption(0, true))\n    return\n  }\n\n  if (isValueExists(previousOptionComputed.value)) {\n    updateFocusedOption(previousOptionComputed.value)\n  } else {\n    emit('no-previous-option-to-hover')\n  }\n}\n\nconst focusNextOption = () => {\n  if (!isValueExists(currentOptionComputed.value)) {\n    focusFirstOption()\n    return\n  }\n\n  const nextOptionIndex = currentOptionIndex.value + 1\n  const nextOption = currentOptions.value[nextOptionIndex]\n  const nextOptionCheck = isValueExists(nextOption) && !(nextOptionIndex === currentOptions.value.length - 1 && getDisabled(nextOption))\n  if (nextOptionCheck) {\n    updateFocusedOption(findNextActiveOption(currentOptionIndex.value + 1))\n  }\n}\n\nconst focusFirstOption = () => updateFocusedOption(findNextActiveOption(0))\n\nconst { itemRefs, setItemRef } = useObjectRefs()\nconst virtualScrollerRef = shallowRef<Array<ComponentPublicInstance>>()\nconst scrollToOption = (option: SelectOption) => {\n  if (!isValueExists(option)) { return }\n\n  const element = unwrapEl(itemRefs.value[getTrackBy(option)])\n  if (element) { scrollToElement(element) }\n\n  const virtualScroller = virtualScrollerRef.value?.[0]\n\n  if (props.virtualScroller) { (virtualScroller as any).virtualScrollTo(currentOptionIndex.value) }\n}\n\nwatch(() => props.hoveredOption, (newOption: SelectOption | null) => {\n  (!lastInteractionSource.value || lastInteractionSource.value === 'keyboard') &&\n  (isValueExists(newOption)) && scrollToOption(newOption)\n})\n\nwatch(filteredOptions, () => {\n  if (!props.autoSelectFirstOption) { return }\n\n  focusFirstOption()\n}, { immediate: true })\n\ndefineExpose({\n  focusPreviousOption,\n  focusNextOption,\n  focusFirstOption,\n  scrollToOption,\n  focus,\n})\n</script>\n\n<style lang=\"scss\">\n@import \"../../../../styles/resources\";\n@import \"variables\";\n\n.va-select-option-list {\n  overflow: auto;\n  width: var(--va-select-option-list-width);\n  max-height: var(--va-select-option-list-max-height);\n  display: flex;\n  flex-direction: column;\n  font-family: var(--va-font-family);\n\n  &--empty {\n    padding: var(--va-select-option-list-empty-block-padding);\n  }\n\n  @include va-scroll(var(--va-primary));\n\n  &__group-name {\n    padding: var(--va-select-option-list-group-name-padding);\n    font-size: var(--va-select-option-list-group-name-font-size);\n    color: var(--va-select-option-list-group-name-color);\n    font-weight: var(--va-select-option-list-group-name-font-weight);\n    text-transform: var(--va-select-option-list-group-name-text-transform);\n  }\n}\n</style>\n"],"names":[],"mappings":"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"}