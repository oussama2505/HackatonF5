{"version":3,"file":"VaDropdown.vue_vue_type_script_lang.js","sources":["../../../../../src/components/va-dropdown/VaDropdown.vue"],"sourcesContent":["<script lang=\"ts\">\nimport {\n  h,\n  defineComponent,\n  PropType,\n  computed,\n  nextTick,\n  ref,\n  Fragment,\n  Teleport,\n  watchEffect,\n  watch,\n} from 'vue'\nimport pick from 'lodash/pick'\nimport {\n  MaybeHTMLElementOrSelector,\n  createStatefulProps,\n  useBem,\n  useClickOutside,\n  useHTMLElement,\n  useHTMLElementSelector,\n  useIsMounted,\n  useStateful,\n  useStatefulEmits,\n  useTranslation, useTranslationProp,\n  usePlacementAliasesProps,\n} from '../../composables'\nimport { renderSlotNode } from '../../utils/headless'\nimport { useNavigation, Trigger } from './hooks/useDropdownNavigation'\nimport { useAnchorSelector } from './hooks/useAnchorSelector'\nimport { useCursorAnchor } from './hooks/useCursorAnchor'\nimport { CursorAnchor, DropdownOffsetProp } from './types'\nimport { useDropdown } from './hooks/useDropdown'\nimport { warn } from '../../utils/console'\nimport { useFocusOutside } from '../../composables/useFocusOutside'\nimport { useTeleported } from '../../composables/useTeleported'\nimport { StringWithAutocomplete } from '../../utils/types/prop-type'\nimport { useZIndex } from '../../composables/useZIndex'\nimport { focusFirstFocusableChild } from '../../utils/focus'\nimport { unwrapEl } from '../../utils/unwrapEl'\n\nexport default defineComponent({\n  name: 'VaDropdown',\n  props: {\n    ...usePlacementAliasesProps,\n    ...createStatefulProps(true),\n    modelValue: { type: Boolean, default: false },\n    anchor: { type: [String, Object] as PropType<MaybeHTMLElementOrSelector>, default: undefined },\n    anchorSelector: { type: String, default: '' },\n    innerAnchorSelector: { type: String, default: '' },\n    trigger: {\n      type: [String, Array] as PropType<Trigger | readonly Trigger[]>,\n      default: () => ['click', 'space', 'enter', 'arrow-down', 'arrow-up'],\n    },\n    disabled: { type: Boolean },\n    readonly: { type: Boolean },\n    closeOnClickOutside: { type: Boolean, default: true },\n    closeOnFocusOutside: { type: Boolean, default: true },\n    closeOnAnchorClick: { type: Boolean, default: true },\n    closeOnContentClick: { type: Boolean, default: true },\n    hoverOverTimeout: { type: [Number, String], default: 30 },\n    hoverOutTimeout: { type: [Number, String], default: 200 },\n    isContentHoverable: { type: Boolean, default: true },\n    offset: { type: [Array, Number] as PropType<DropdownOffsetProp>, default: 0 },\n    keepAnchorWidth: { type: Boolean, default: false },\n    verticalScrollOnOverflow: { type: Boolean, default: true },\n    cursor: { type: [Boolean, Object] as PropType<boolean | CursorAnchor>, default: false },\n    autoPlacement: { type: Boolean, default: true },\n    stickToEdges: { type: Boolean, default: false },\n    /** Viewport where dropdown will be rendered. Autoplacement will be calculated relative to `target` */\n    target: { type: [String, Object] as PropType<MaybeHTMLElementOrSelector>, default: undefined },\n    /** Element where dropdown content will be rendered. */\n    teleport: { type: [String, Object] as PropType<MaybeHTMLElementOrSelector>, default: undefined },\n    /** Not reactive */\n    keyboardNavigation: { type: Boolean, default: true },\n    ariaLabel: useTranslationProp('$t:toggleDropdown'),\n    role: { type: String as PropType<StringWithAutocomplete<'button' | 'none'>>, default: 'button' },\n    contentClass: { type: String, default: '' },\n  },\n\n  emits: [...useStatefulEmits, 'anchor-click', 'anchor-right-click', 'content-click', 'click-outside', 'focus-outside', 'close', 'open', 'anchor-dblclick'],\n\n  setup (props, { emit }) {\n    const { valueComputed } = useStateful(props, emit, 'modelValue')\n\n    watch(valueComputed, (isOpened) => {\n      if (isOpened) {\n        emit('open')\n      } else {\n        emit('close')\n      }\n    })\n\n    const isMounted = useIsMounted()\n\n    const { anchorRef } = useAnchorSelector(props)\n    const cursorAnchor = useCursorAnchor(anchorRef, computed(() => Boolean(props.cursor)))\n    const floating = useHTMLElement('floating')\n    const body = useHTMLElementSelector(ref('body'))\n    const target = useHTMLElementSelector(computed(() => props.target))\n    const teleport = useHTMLElementSelector(computed(() => props.teleport))\n\n    const anchorClass = useBem('va-dropdown', () => pick(props, ['disabled']))\n    const teleportTarget = computed<HTMLElement | undefined>(() => {\n      if (teleport.value) {\n        return teleport.value\n      }\n\n      if (target.value) {\n        return target.value\n      }\n\n      if (anchorRef.value) {\n        const root = anchorRef.value.getRootNode()\n        if (root instanceof ShadowRoot) {\n          const el = [...root.children].find((c) => c.tagName !== 'STYLE')\n\n          if (el) {\n            return el as HTMLElement\n          }\n        }\n      }\n\n      return body.value\n    })\n\n    const showFloating = computed(() => isMounted.value && valueComputed.value)\n\n    useNavigation(\n      valueComputed,\n      anchorRef,\n      floating,\n      props,\n    )\n\n    const emitAndClose = (eventName: Parameters<typeof emit>[0], close?: boolean, e?: Event) => {\n      emit(eventName, e)\n      if (close) { valueComputed.value = false }\n    }\n\n    useClickOutside([anchorRef, floating], () => {\n      if (props.closeOnClickOutside && valueComputed.value) {\n        emitAndClose('click-outside', props.closeOnClickOutside)\n      }\n    })\n\n    useFocusOutside([floating], () => {\n      if (props.closeOnFocusOutside && valueComputed.value) {\n        emitAndClose('focus-outside', props.closeOnFocusOutside)\n      }\n    }, { onlyKeyboard: true })\n\n    const anchorComputed = computed(() => {\n      if (typeof props.cursor === 'object') {\n        return props.cursor\n      }\n\n      return props.cursor ? cursorAnchor.value : anchorRef.value\n    })\n\n    const { floatingStyles } = useDropdown(\n      anchorComputed,\n      floating,\n      target,\n      computed(() => ({\n        placement: props.placement,\n        offset: props.offset,\n        autoPlacement: props.autoPlacement,\n        stickToEdges: props.stickToEdges,\n        keepAnchorWidth: props.keepAnchorWidth,\n        verticalScrollOnOverflow: props.verticalScrollOnOverflow,\n      })),\n    )\n\n    const hide = () => { valueComputed.value = false }\n    const show = () => { valueComputed.value = true }\n\n    const {\n      zIndex,\n    } = useZIndex(valueComputed)\n\n    watch(valueComputed, (isOpened) => {\n      if (!props.keyboardNavigation) { return }\n\n      if (isOpened) {\n        nextTick(() => {\n          const el = unwrapEl(floating.value)\n          if (!el) { return }\n          focusFirstFocusableChild(el)\n        })\n      } else {\n        if (!anchorRef.value) { return }\n        focusFirstFocusableChild(anchorRef.value)\n      }\n    })\n\n    return {\n      ...useTranslation(),\n      ...useTeleported(),\n      anchorRef,\n      anchorClass,\n      floating,\n      floatingStyles,\n      showFloating,\n      teleportTarget,\n      isMounted,\n      valueComputed,\n      hide,\n      show,\n      zIndex,\n    }\n  },\n\n  render () {\n    const slotBind = {\n      isOpened: this.valueComputed,\n      hide: this.hide,\n      show: this.show,\n      toggle: () => this.valueComputed ? this.hide() : this.show(),\n      getAnchorWidth: () => this.anchorRef?.offsetWidth + 'px',\n      getAnchorHeight: () => this.anchorRef?.offsetHeight + 'px',\n    }\n\n    const floatingSlotNode = this.showFloating && renderSlotNode(this.$slots.default, slotBind, {\n      ref: 'floating',\n      class: ['va-dropdown__content-wrapper', this.$props.contentClass],\n      style: [this.floatingStyles, { zIndex: this.zIndex }],\n      ...this.teleportedAttrs,\n    })\n\n    const anchorSlotVNode = renderSlotNode(this.$slots.anchor, slotBind, {\n      ref: 'anchorRef',\n      role: this.$props.role,\n      class: ['va-dropdown', ...this.anchorClass.asArray.value],\n      style: { position: 'relative' },\n      'aria-label': this.tp(this.$props.ariaLabel),\n      'aria-disabled': this.$props.disabled,\n      'aria-expanded': this.$props.role && this.$props.role !== 'none' ? !!this.showFloating : undefined,\n      ...this.teleportFromAttrs,\n      ...this.$attrs,\n    })\n\n    if (typeof this.$props.cursor === 'object' && floatingSlotNode) {\n      return h(\n        Teleport,\n        {\n          to: this.teleportTarget,\n          disabled: this.$props.disabled,\n        },\n        [floatingSlotNode],\n      )\n    }\n\n    if (!this.$props.anchorSelector && !anchorSlotVNode) {\n      warn('VaDropdown: #anchor slot is missing')\n      return\n    }\n\n    if (this.showFloating && !floatingSlotNode) {\n      warn('VaDropdown: default slot is missing')\n      return\n    }\n\n    return h(Fragment, {}, [\n      anchorSlotVNode,\n      (floatingSlotNode) && h(\n        Teleport,\n        {\n          to: this.teleportTarget,\n          disabled: this.$props.disabled,\n        },\n        [floatingSlotNode],\n      ),\n    ])\n  },\n})\n</script>\n\n<style lang=\"scss\">\n@import '../../styles/resources';\n@import 'variables';\n\n.va-dropdown {\n  /* Solved the alignment problem (if we try to align inline and block elements) */\n  line-height: var(--va-dropdown-line-height);\n  font-family: var(--va-font-family);\n  display: var(--va-dropdown-display);\n  position: relative;\n  max-width: 100%;\n  vertical-align: middle;\n\n  &--disabled {\n    @include va-disabled;\n  }\n\n  &__content-wrapper {\n    z-index: var(--va-dropdown-content-wrapper-z-index);\n    font-family: var(--va-font-family);\n    top: 0;\n    left: 0;\n    position: absolute;\n  }\n}\n</style>\n"],"names":[],"mappings":"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"}