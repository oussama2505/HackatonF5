{"version":3,"file":"VaParallax.vue_vue_type_script_setup_true_lang.js","sources":["../../../../../src/components/va-parallax/VaParallax.vue"],"sourcesContent":["<template>\n  <div\n    ref=\"rootElement\"\n    class=\"va-parallax\"\n    :style=\"computedWrapperStyles\"\n  >\n    <div class=\"va-parallax__image-container\">\n      <img\n        ref=\"img\"\n        class=\"va-parallax__image\"\n        :src=\"$props.src\"\n        :alt=\"$props.alt\"\n        :style=\"computedImgStyles\"\n      />\n    </div>\n    <div class=\"va-parallax__item-container\">\n      <slot />\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { useComponentPresetProp } from '../../composables/useComponentPreset'\nimport { useScrollParent } from '../../composables/useScrollParent'\nimport { PropType, ref, computed, onMounted, onBeforeUnmount, shallowRef, ComputedRef } from 'vue'\nimport { warn } from '../../utils/console'\nimport { useNumericProp } from '../../composables'\n\ndefineOptions({\n  name: 'VaParallax',\n})\n\nconst props = defineProps({\n  ...useComponentPresetProp,\n  target: { type: [Object, String] as PropType<HTMLElement | string | undefined> },\n  src: { type: String, default: '', required: true },\n  alt: { type: String, default: 'parallax' },\n  height: { type: [Number, String], default: 400 },\n  reversed: { type: Boolean, default: false },\n  speed: {\n    type: [Number, String],\n    default: 0.5,\n    validator: (value: number | string) => {\n      const num = Number(value)\n      return num >= 0 && num <= 1\n    },\n  },\n})\n\nconst rootElement = shallowRef<HTMLElement>()\nconst img = shallowRef<HTMLImageElement>()\n\nconst elOffsetTop = ref(0)\nconst parallax = ref(0)\nconst parallaxDist = ref(0)\nconst percentScrolled = ref(0)\nconst scrollTop = ref(0)\nconst windowHeight = ref(0)\nconst windowBottom = ref(0)\nconst isLoaded = ref(false)\n\nconst computedWrapperStyles = computed(() => ({ height: heightComputed.value + 'px' }))\n\nconst computedImgStyles = computed(() => ({\n  display: 'block',\n  transform: `translate(-50%, ${parallax.value}px)`,\n  opacity: isLoaded.value ? 1 : 0,\n  top: props.reversed ? 0 : 'auto',\n}))\n\nconst { getScrollableParent } = useScrollParent()\n\nconst targetElement = computed(() => {\n  if (!props.target) {\n    return getScrollableParent(rootElement.value?.parentElement)\n  }\n\n  if (props.target instanceof HTMLElement) { // there is a bug if to target passed ref\n    return props.target\n  }\n\n  const element = document.querySelector(props.target)\n\n  if (element) { return element }\n\n  warn('VaParallax target prop got wrong selector. Target is null')\n  return null\n})\n\nconst imgHeight = computed(() => img.value?.naturalHeight || 0)\n\nconst heightComputed = useNumericProp('height') as ComputedRef<number>\nconst speedComputed = useNumericProp('speed') as ComputedRef<number>\nconst calcDimensions = () => {\n  const offset = rootElement.value?.getBoundingClientRect() || { top: 0 }\n\n  scrollTop.value = targetElement.value?.scrollTop || 0\n  parallaxDist.value = imgHeight.value - heightComputed.value\n  elOffsetTop.value = offset.top + scrollTop.value\n  windowHeight.value = window.innerHeight\n  windowBottom.value = scrollTop.value + windowHeight.value\n}\n\nconst translate = () => {\n  calcDimensions()\n\n  percentScrolled.value = (windowBottom.value - elOffsetTop.value) / (heightComputed.value + windowHeight.value)\n\n  parallax.value = Math.round(parallaxDist.value * percentScrolled.value) * speedComputed.value\n\n  if (props.reversed) {\n    parallax.value = -parallax.value\n  }\n}\n\nconst addEventListeners = () => {\n  targetElement.value?.addEventListener('scroll', translate)\n  targetElement.value?.addEventListener('resize', translate)\n}\n\nconst removeEventListeners = () => {\n  targetElement.value?.removeEventListener('scroll', translate)\n  targetElement.value?.removeEventListener('resize', translate)\n}\n\nconst initImage = () => {\n  if (img.value?.complete) {\n    translate()\n    addEventListeners()\n  } else {\n    img.value?.addEventListener('load', () => {\n      translate()\n      addEventListeners()\n    }, false)\n  }\n\n  isLoaded.value = true\n}\n\nonMounted(initImage)\nonBeforeUnmount(removeEventListeners)\n</script>\n\n<style lang=\"scss\">\n@import \"../../styles/resources\";\n@import \"variables\";\n\n.va-parallax {\n  display: var(--va-parallax-display);\n  position: relative;\n  overflow: hidden;\n  width: var(--va-parallax-width);\n  z-index: var(--va-parallax-z-index);\n  font-family: var(--va-font-family);\n\n  &__image-container {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 1;\n    contain: var(--va-parallax-image-container-contain);\n    user-select: var(--va-parallax-image-container-user-select);\n  }\n\n  &__image {\n    position: absolute;\n    bottom: 0;\n    left: 50%;\n    min-width: 100%;\n    max-width: unset;\n    min-height: 100%;\n    display: none;\n    transform: translate(-50%, 0);\n    will-change: var(--va-parallax-image-will-change);\n    transition: var(--va-parallax-image-transition);\n    z-index: 1;\n  }\n\n  &__item-container {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 2;\n    contain: strict;\n  }\n}\n</style>\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgCA,UAAM,QAAQ;AAiBd,UAAM,cAAc;AACpB,UAAM,MAAM;AAEN,UAAA,cAAc,IAAI,CAAC;AACnB,UAAA,WAAW,IAAI,CAAC;AAChB,UAAA,eAAe,IAAI,CAAC;AACpB,UAAA,kBAAkB,IAAI,CAAC;AACvB,UAAA,YAAY,IAAI,CAAC;AACjB,UAAA,eAAe,IAAI,CAAC;AACpB,UAAA,eAAe,IAAI,CAAC;AACpB,UAAA,WAAW,IAAI,KAAK;AAEpB,UAAA,wBAAwB,SAAS,OAAO,EAAE,QAAQ,eAAe,QAAQ,KAAO,EAAA;AAEhF,UAAA,oBAAoB,SAAS,OAAO;AAAA,MACxC,SAAS;AAAA,MACT,WAAW,mBAAmB,SAAS,KAAK;AAAA,MAC5C,SAAS,SAAS,QAAQ,IAAI;AAAA,MAC9B,KAAK,MAAM,WAAW,IAAI;AAAA,IAC1B,EAAA;AAEI,UAAA,EAAE,wBAAwB;AAE1B,UAAA,gBAAgB,SAAS,MAAM;;AAC/B,UAAA,CAAC,MAAM,QAAQ;AACV,eAAA,qBAAoB,iBAAY,UAAZ,mBAAmB,aAAa;AAAA,MAC7D;AAEI,UAAA,MAAM,kBAAkB,aAAa;AACvC,eAAO,MAAM;AAAA,MACf;AAEA,YAAM,UAAU,SAAS,cAAc,MAAM,MAAM;AAEnD,UAAI,SAAS;AAAS,eAAA;AAAA,MAAQ;AAE9B,WAAK,2DAA2D;AACzD,aAAA;AAAA,IAAA,CACR;AAED,UAAM,YAAY,SAAS,MAAM;;AAAA,wBAAI,UAAJ,mBAAW,kBAAiB;AAAA,KAAC;AAExD,UAAA,iBAAiB,eAAe,QAAQ;AACxC,UAAA,gBAAgB,eAAe,OAAO;AAC5C,UAAM,iBAAiB,MAAM;;AAC3B,YAAM,WAAS,iBAAY,UAAZ,mBAAmB,4BAA2B,EAAE,KAAK;AAE1D,gBAAA,UAAQ,mBAAc,UAAd,mBAAqB,cAAa;AACvC,mBAAA,QAAQ,UAAU,QAAQ,eAAe;AAC1C,kBAAA,QAAQ,OAAO,MAAM,UAAU;AAC3C,mBAAa,QAAQ,OAAO;AACf,mBAAA,QAAQ,UAAU,QAAQ,aAAa;AAAA,IAAA;AAGtD,UAAM,YAAY,MAAM;AACP;AAEf,sBAAgB,SAAS,aAAa,QAAQ,YAAY,UAAU,eAAe,QAAQ,aAAa;AAE/F,eAAA,QAAQ,KAAK,MAAM,aAAa,QAAQ,gBAAgB,KAAK,IAAI,cAAc;AAExF,UAAI,MAAM,UAAU;AACT,iBAAA,QAAQ,CAAC,SAAS;AAAA,MAC7B;AAAA,IAAA;AAGF,UAAM,oBAAoB,MAAM;;AAChB,0BAAA,UAAA,mBAAO,iBAAiB,UAAU;AAClC,0BAAA,UAAA,mBAAO,iBAAiB,UAAU;AAAA,IAAS;AAG3D,UAAM,uBAAuB,MAAM;;AACnB,0BAAA,UAAA,mBAAO,oBAAoB,UAAU;AACrC,0BAAA,UAAA,mBAAO,oBAAoB,UAAU;AAAA,IAAS;AAG9D,UAAM,YAAY,MAAM;;AAClB,WAAA,SAAI,UAAJ,mBAAW,UAAU;AACb;AACQ;MAAA,OACb;AACD,kBAAA,UAAA,mBAAO,iBAAiB,QAAQ,MAAM;AAC9B;AACQ;WACjB;AAAA,MACL;AAEA,eAAS,QAAQ;AAAA,IAAA;AAGnB,cAAU,SAAS;AACnB,oBAAgB,oBAAoB;;;;;;;;;;;;;;;;;;;;;;;;;"}